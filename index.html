<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saha ≈ûefi V15 - Akƒ±llƒ± Sorgu</title>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: sans-serif; text-align: center; padding: 10px; margin: 0; }
        .wrapper { max-width: 600px; margin: 15px auto; background: #161b22; padding: 20px; border-radius: 30px; border: 2px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* ARAMA KUTUSU STƒ∞Lƒ∞ */
        .search-container { margin-bottom: 20px; position: relative; }
        #text-query { 
            width: 85%; padding: 15px; border-radius: 15px; border: 2px solid #30363d; 
            background: #0d1117; color: white; font-size: 1.1rem; outline: none; transition: 0.3s;
        }
        #text-query:focus { border-color: #58a6ff; box-shadow: 0 0 10px #58a6ff; }

        /* DEV BA≈ûLAT BUTONU */
        #main-btn { 
            width: 100%; padding: 40px 10px; font-size: 2rem; font-weight: 900; 
            background: #238636; color: white; border: none; border-radius: 20px; 
            cursor: pointer; margin-bottom: 15px;
        }
        #main-btn.active { background: #da3633; box-shadow: 0 0 30px #da3633; }
        
        #status-bar { margin: 10px 0; font-size: 1.2rem; font-weight: bold; color: #58a6ff; }
        #live-text { color: #8b949e; font-size: 1rem; background: #0d1117; padding: 12px; border-radius: 12px; border: 1px inset #30363d; min-height: 20px; margin-bottom: 15px; }
        
        /* √áIKTI ALANI */
        #output-container { background: #010409; padding: 15px; border-radius: 15px; display: none; text-align: left; }
        #json-box { width: 100%; height: 100px; background: transparent; color: #7ee787; border: none; font-family: monospace; font-size: 0.7rem; resize: none; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2 style="color:#f0f6fc; margin-bottom:15px;">GERBER SL100 KOMUTA</h2>

    <div class="search-container">
        <input type="text" id="text-query" placeholder="Par√ßa, ID veya Soru yazƒ±n..." onkeypress="klavyeSorgu(event)">
    </div>
    
    <div id="status-bar">Sistem Hazƒ±r!</div>
    
    <button id="main-btn">üéôÔ∏è SESLƒ∞ KOMUT</button>
    
    <div id="live-text">Sonu√ß: -</div>

    <div id="output-container">
        <div style="font-size: 0.7rem; color: #8b949e;">√ñƒürenilen Veri:</div>
        <textarea id="json-box" readonly></textarea>
    </div>
</div>

<script>
    const MUHABBET_URL = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/main/muhabbet.js";
    const IS_EMIRLERI_URL = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/refs/heads/main/is_emirleri.json";

    let combinedDB = [];
    let isListening = false;
    let learningMode = false;
    let lastQuestion = "";

    const btn = document.getElementById('main-btn');
    const status = document.getElementById('status-bar');
    const liveText = document.getElementById('live-text');
    const textQuery = document.getElementById('text-query');

    // VERƒ∞LERƒ∞ √áEK VE Bƒ∞RLE≈ûTƒ∞R
    async function init() {
        try {
            const [res1, res2] = await Promise.all([
                fetch(MUHABBET_URL + "?v=" + Date.now()),
                fetch(IS_EMIRLERI_URL + "?v=" + Date.now())
            ]);
            const muhabbetText = await res1.text();
            const mData = JSON.parse(muhabbetText.replace(/[^\[]*(\[.*\])[^\]]*/s, '$1'));
            const iData = await res2.json();
            
            // ƒ∞≈ü emirlerini muhabbet formatƒ±na √ßevirip birle≈ütiriyoruz
            const formattedIs = iData.map(item => ({
                soru: item.id.toString(), 
                cevap: `${item.baslik}: ${item.durum}. ${item.aciklama}`
            }));
            
            combinedDB = [...mData, ...formattedIs];
            status.innerText = "Veritabanƒ± Baƒülandƒ±!";
        } catch (e) {
            status.innerText = "Baƒülantƒ± Hatasƒ±!";
        }
    }

    // KLAVYE ƒ∞LE SORGULAMA
    function klavyeSorgu(e) {
        if (e.key === 'Enter') {
            processQuery(textQuery.value);
            textQuery.value = ""; // Kutuyu temizle
        }
    }

    // ORTAK ƒ∞≈ûLEME MERKEZƒ∞
    function processQuery(val) {
        const query = val.toLowerCase().trim();
        if (!query) return;

        liveText.innerText = "Sorgu: " + query;

        if (learningMode) {
            saveLearning(query);
            return;
        }

        const match = combinedDB.find(i => query.includes(i.soru.toLowerCase()) || i.soru.toLowerCase() === query);
        
        if (match) {
            speak(match.cevap);
            liveText.innerText = "Cevap: " + match.cevap;
        } else {
            learningMode = true;
            lastQuestion = query;
            status.innerText = "√ñƒûRENME MODU";
            speak(query + " nedir ≈üefim? Cevabƒ±nƒ± yazƒ±n veya s√∂yleyin.");
        }
    }

    // √ñƒûRENƒ∞LENƒ∞ KAYDET
    function saveLearning(answer) {
        combinedDB.unshift({soru: lastQuestion, cevap: answer});
        learningMode = false;
        status.innerText = "√ñƒürenildi!";
        document.getElementById('json-box').value = JSON.stringify(combinedDB, null, 2);
        document.getElementById('output-container').style.display = "block";
        speak("Anla≈üƒ±ldƒ±, kaydƒ± hazƒ±rladƒ±m ≈üefim.");
    }

    // SES MOTORU
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new Speech();
    recognition.lang = 'tr-TR';
    recognition.continuous = true;

    function speak(text) {
        recognition.stop();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'tr-TR';
        msg.onend = () => { if (isListening) recognition.start(); };
        window.speechSynthesis.speak(msg);
    }

    btn.onclick = () => {
        if (!isListening) {
            recognition.start();
            isListening = true;
            btn.innerText = "DURDUR"; btn.classList.add('active');
            status.innerText = "Dinliyorum...";
        } else {
            recognition.stop();
            isListening = false;
            btn.innerText = "SESLƒ∞ KOMUT"; btn.classList.remove('active');
        }
    };

    recognition.onresult = (event) => {
        const text = event.results[event.results.length - 1][0].transcript;
        processQuery(text);
    };

    window.onload = init;
</script>
</body>
</html>
