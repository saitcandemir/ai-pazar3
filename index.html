 <!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saha ≈ûefi V18 - Kesintisiz Komuta</title>
    <style>
        body { background: #0b0e14; color: #e6edf3; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 10px; margin: 0; }
        .wrapper { max-width: 600px; margin: 10px auto; background: #161b22; padding: 20px; border-radius: 25px; border: 2px solid #30363d; box-shadow: 0 8px 32px rgba(0,0,0,0.8); }
        
        /* ARAMA KUTUSU */
        .input-group { margin-bottom: 15px; }
        #text-query { 
            width: 90%; padding: 15px; border-radius: 12px; border: 2px solid #30363d; 
            background: #0d1117; color: #58a6ff; font-size: 1.2rem; outline: none; text-align: center;
        }
        #text-query:focus { border-color: #238636; }

        /* DEV BUTON */
        #main-btn { 
            width: 100%; padding: 45px 10px; font-size: 2.2rem; font-weight: 900; 
            background: #238636; color: white; border: none; border-radius: 20px; 
            cursor: pointer; transition: 0.2s;
        }
        #main-btn.active { background: #da3633; box-shadow: 0 0 30px #da3633; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        
        #status { margin: 10px 0; font-size: 1.1rem; color: #8b949e; font-style: italic; }
        #live-text { background: #0d1117; padding: 15px; border-radius: 12px; border: 1px solid #30363d; min-height: 50px; line-height: 1.6; color: #d1d5db; }
        
        #json-output { width: 100%; height: 100px; background: #000; color: #3fb950; font-family: monospace; font-size: 0.7rem; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2 style="color:#f0f6fc;">Saha ≈ûefi V18 - Tam Yetki</h2>
    
    <div class="input-group">
        <input type="text" id="text-query" placeholder="Yazƒ±n veya Konu≈üun..." onkeypress="handleEnter(event)">
    </div>

    <button id="main-btn">üéôÔ∏è Sƒ∞STEMƒ∞ A√á</button>
    <div id="status">Veriler y√ºkleniyor...</div>
    <div id="live-text">Komut bekleniyor ≈üefim.</div>
    
    <textarea id="json-output" readonly onclick="this.select(); document.execCommand('copy'); alert('Kod kopyalandƒ±!');"></textarea>
</div>

<script>
    const GITHUB_MUHABBET = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/main/muhabbet.js";
    const GITHUB_ISEMRI = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/refs/heads/main/is_emirleri.json";

    let database = [];
    let isListening = false;
    let learningMode = false;
    let lastQuery = "";

    // 1. VERƒ∞LERƒ∞ √áEK VE HATALARI TEMƒ∞ZLE
    async function setup() {
        try {
            const [r1, r2] = await Promise.all([
                fetch(GITHUB_MUHABBET + "?t=" + Date.now()),
                fetch(GITHUB_ISEMRI + "?t=" + Date.now())
            ]);

            const mRaw = await r1.text();
            // Regex ile sadece k√∂≈üeli parantez i√ßini al (Hatalƒ± JS formatƒ±nƒ± JSON'a zorla)
            const mData = JSON.parse(mRaw.match(/\[.*\]/s)[0]);
            const iData = await r2.json();

            // ƒ∞ki veriyi tek bir "S√ºper Liste"de birle≈ütir
            database = [...mData, ...iData];
            document.getElementById('status').innerText = "Sistem Kesintisiz Aktif!";
        } catch (e) {
            document.getElementById('status').innerText = "Veri okuma hatasƒ±! JSON formatƒ±nƒ± kontrol et ≈üefim.";
            console.error(e);
        }
    }

    // 2. AKILLI ARAMA MOTORU (ENGEL TANIMAZ)
    function searchEngine(input) {
        const query = input.toLowerCase().trim();
        if (!query) return;

        document.getElementById('live-text').innerText = "Duyulan: " + query;

        if (learningMode) {
            learnNew(query);
            return;
        }

        // DATABASE ƒ∞√áƒ∞NDE HER YERE BAK (ƒ∞≈ü ID, Soru, A√ßƒ±klama)
        const found = database.find(item => {
            const keys = Object.values(item).map(v => v.toString().toLowerCase());
            return keys.some(k => k === query || k.includes(query));
        });

        if (found) {
            let reply = "";
            // Eƒüer Muhabbet formatƒ±ndaysa
            if (found.cevap) {
                reply = found.cevap;
            } 
            // Eƒüer senin ƒ∞≈ü Emri formatƒ±ndaysa
            else if (found["ƒ∞≈ü ID"]) {
                reply = `${found["ƒ∞≈ü ID"]} nolu i≈ü, ${found["ƒ∞≈ü A√ßƒ±klamasƒ±"]}. ` +
                        `Kaynak: ${found["Kaynak√ßƒ± S√ºresi (Dakika)"]} dk, ` +
                        `Torna: ${found["Tornacƒ± S√ºresi (Dakika)"]} dk, ` +
                        `Montaj: ${found["Montajcƒ± S√ºresi (Dakika)"]} dk. ` +
                        `Sevkiyat: ${found["sevkƒ±yat S√ºresi (Dakika)"]} dk ≈üefim.`;
            }

            speak(reply);
            document.getElementById('live-text').innerText = reply;
        } else {
            learningMode = true;
            lastQuery = query;
            document.getElementById('status').innerText = "√ñƒûRENME MODU";
            speak(query + " nedir ≈üefim? Cevabƒ±nƒ± s√∂yle kaydedeyim.");
        }
    }

    function learnNew(ans) {
        const newData = {"soru": lastQuery, "cevap": ans};
        // Sadece muhabbet kƒ±smƒ±na ekle
        const muhabbetOnly = database.filter(x => x.soru); 
        muhabbetOnly.unshift(newData);
        
        learningMode = false;
        document.getElementById('status').innerText = "√ñƒürenildi!";
        document.getElementById('json-output').style.display = "block";
        document.getElementById('json-output').value = JSON.stringify(muhabbetOnly, null, 2);
        speak("Tamam ≈üefim, artƒ±k biliyorum. Kodu en √ºste ekledim.");
    }

    // SES VE KLAVYE
    function handleEnter(e) { if(e.key === 'Enter') { searchEngine(e.target.value); e.target.value = ""; } }

    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new Speech();
    recognition.lang = 'tr-TR';
    recognition.continuous = true;

    function speak(txt) {
        recognition.stop();
        const s = new SpeechSynthesisUtterance(txt);
        s.lang = 'tr-TR';
        s.onend = () => { if(isListening) recognition.start(); };
        window.speechSynthesis.speak(s);
    }

    document.getElementById('main-btn').onclick = () => {
        if (!isListening) {
            recognition.start();
            isListening = true;
            document.getElementById('main-btn').innerText = "DURDUR";
            document.getElementById('main-btn').classList.add('active');
            speak("Sistem emrinde ≈üefim.");
        } else {
            recognition.stop();
            isListening = false;
            document.getElementById('main-btn').innerText = "Sƒ∞STEMƒ∞ A√á";
            document.getElementById('main-btn').classList.remove('active');
        }
    };

    recognition.onresult = (e) => { searchEngine(e.results[e.results.length - 1][0].transcript); };

    window.onload = setup;
</script>
</body>
</html>
