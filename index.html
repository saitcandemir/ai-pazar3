<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saha Åefi V14 - GitHub AI</title>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: sans-serif; text-align: center; padding: 10px; margin: 0; }
        .wrapper { max-width: 600px; margin: 20px auto; background: #161b22; padding: 25px; border-radius: 30px; border: 2px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* DEV BAÅLAT BUTONU */
        #main-btn { 
            width: 100%; padding: 60px 10px; font-size: 2.5rem; font-weight: 900; 
            background: #238636; color: white; border: none; border-radius: 20px; 
            cursor: pointer; transition: 0.3s; margin-bottom: 15px;
        }
        #main-btn.active { background: #da3633; box-shadow: 0 0 40px #da3633; }
        
        #status-bar { margin: 15px 0; font-size: 1.3rem; font-weight: bold; color: #58a6ff; min-height: 35px; }
        #live-text { color: #8b949e; font-size: 1.1rem; background: #0d1117; padding: 15px; border-radius: 15px; border: 1px inset #30363d; margin-bottom: 20px; }
        
        /* GITHUB Ã‡IKTI ALANI */
        #output-container { background: #010409; padding: 15px; border-radius: 15px; border: 1px solid #30363d; text-align: left; display: none; }
        #json-box { width: 100%; height: 120px; background: transparent; color: #7ee787; border: none; font-family: monospace; font-size: 0.8rem; resize: none; }
        .copy-btn { background: #30363d; color: white; border: 1px solid #8b949e; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.7rem; margin-top: 5px; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2 style="color:#f0f6fc; margin-bottom:5px;">AI-PAZAR3 KOMUTA</h2>
    <div id="status-bar">Sistem HazÄ±rlanÄ±yor...</div>
    
    <button id="main-btn">ğŸ™ï¸ BAÅLAT</button>
    
    <div id="live-text">Duyulan: -</div>

    <div id="output-container">
        <div style="font-size: 0.7rem; color: #8b949e; margin-bottom: 5px;">Yeni Ã–ÄŸrenilen (Kopyala GitHub'a YapÄ±ÅŸtÄ±r):</div>
        <textarea id="json-box" readonly></textarea>
        <button class="copy-btn" onclick="kopyala()">KODU KOPYALA</button>
    </div>
</div>

<script>
    // --- GITHUB LÄ°NKLERÄ°N ---
    const MUHABBET_URL = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/main/muhabbet.js";
    const IS_EMIRLERI_URL = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/refs/heads/main/is_emirleri.json";

    let muhabbetDB = [];
    let isEmirleriDB = [];
    let isListening = false;
    let learningMode = false;
    let lastUnknownQuestion = "";

    const btn = document.getElementById('main-btn');
    const status = document.getElementById('status-bar');
    const liveText = document.getElementById('live-text');
    const jsonBox = document.getElementById('json-box');
    const outputContainer = document.getElementById('output-container');

    // 1. VERÄ°LERÄ° Ã‡EK
    async function init() {
        try {
            const [res1, res2] = await Promise.all([
                fetch(MUHABBET_URL + "?v=" + Date.now()),
                fetch(IS_EMIRLERI_URL + "?v=" + Date.now())
            ]);
            
            // Muhabbet.js iÃ§eriÄŸini temizle ve parse et (iÃ§inde sadece [] olduÄŸunu varsayÄ±yorum)
            const muhabbetRaw = await res1.text();
            muhabbetDB = JSON.parse(muhabbetRaw.replace(/[^\[]*(\[.*\])[^\]]*/s, '$1'));
            
            isEmirleriDB = await res2.json();
            
            status.innerText = "Sistem Ã‡evrimiÃ§i Åefim!";
        } catch (e) {
            status.innerText = "GitHub BaÄŸlantÄ± Bekleniyor...";
            muhabbetDB = [];
        }
    }

    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new Speech();
    recognition.lang = 'tr-TR';
    recognition.continuous = true;

    function speak(text) {
        recognition.stop();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'tr-TR';
        msg.onend = () => { if (isListening) recognition.start(); };
        window.speechSynthesis.speak(msg);
    }

    btn.onclick = () => {
        if (!isListening) {
            recognition.start();
            isListening = true;
            btn.innerText = "STOP"; btn.classList.add('active');
            status.innerText = "Dinliyorum...";
            speak("BaÄŸlantÄ± kuruldu ÅŸefim, dinlemedeyim.");
        } else {
            recognition.stop();
            isListening = false;
            btn.innerText = "BAÅLAT"; btn.classList.remove('active');
        }
    };

    recognition.onresult = (event) => {
        const text = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
        liveText.innerText = "Duyulan: " + text;

        // Ã–ÄRENME MODU ONAYI VE KAYIT
        if (learningMode) {
            muhabbetDB.unshift({"soru": lastUnknownQuestion, "cevap": text});
            learningMode = false;
            status.innerText = "KayÄ±t HazÄ±r!";
            jsonBox.value = JSON.stringify(muhabbetDB, null, 2);
            outputContainer.style.display = "block";
            speak("AnlaÅŸÄ±ldÄ± ÅŸefim. " + lastUnknownQuestion + " iÃ§in " + text + " cevabÄ±nÄ± hafÄ±zaya aldÄ±m. GitHub'a eklemen iÃ§in kodu hazÄ±rladÄ±m.");
            return;
        }

        // 1. Ä°Å EMÄ°RLERÄ° SORGUSU (ID veya Ä°simle)
        const isEmri = isEmirleriDB.find(is => text.includes(is.id.toString()) || text.includes(is.baslik?.toLowerCase()));
        if (isEmri) {
            speak(isEmri.id + " numaralÄ± iÅŸ emri: " + isEmri.durum + ". Detay: " + isEmri.aciklama);
            return;
        }

        // 2. MUHABBET SORGUSU
        const match = muhabbetDB.find(i => text.includes(i.soru.toLowerCase()));
        if (match) {
            speak(match.cevap);
        } else {
            // BÄ°LMÄ°YORSA SOR VE Ã–ÄREN
            learningMode = true;
            lastUnknownQuestion = text;
            status.innerText = "Ã–ÄRENÄ°YORUM...";
            speak("Bunu henÃ¼z bilmiyorum ÅŸefim. " + text + " denilince ne cevap vereyim?");
        }
    };

    function kopyala() {
        jsonBox.select();
        document.execCommand('copy');
        alert("JSON KopyalandÄ±! Åimdi GitHub'da muhabbet.js dosyasÄ±nÄ± aÃ§Ä±p iÃ§ine yapÄ±ÅŸtÄ±r ve kaydet.");
    }

    window.onload = init;
</script>
</body>
</html>
