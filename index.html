<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Ai Pazar Gemini CanlÄ±</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; text-align: center; padding: 20px; }
        .container { background: #2d2d2d; display: inline-block; padding: 30px; border-radius: 25px; border: 2px solid #4285f4; max-width: 500px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-group { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        input[type="text"] { padding: 12px; border-radius: 10px; border: none; width: 70%; font-size: 16px; background: #eee; color: #333; }
        button { cursor: pointer; transition: 0.3s; border: none; border-radius: 10px; font-weight: bold; }
        .send-btn { background: #34a853; color: white; padding: 10px 20px; }
        .mic-btn { background: #4285f4; color: white; width: 60px; height: 60px; border-radius: 50%; font-size: 25px; margin-bottom: 10px; }
        #status { color: #f1c40f; margin: 15px 0; font-size: 14px; min-height: 20px; font-weight: bold; }
        #aiResponse { background: #3d3d3d; padding: 20px; border-radius: 15px; margin-top: 20px; text-align: left; line-height: 1.5; min-height: 50px; border-left: 5px solid #4285f4; color: #fff; }
        #errorLog { margin-top: 15px; background: #601a1a; color: #ff9999; padding: 10px; border-radius: 8px; font-size: 12px; display: none; text-align: left; border: 1px solid red; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸš€ Ai Pazar Gemini</h1>
    <div id="status">KonuÅŸmak iÃ§in mikrofona bas veya mesaj yaz</div>
    
    <button id="startBtn" class="mic-btn" title="KonuÅŸmak iÃ§in tÄ±kla">ğŸ™ï¸</button>

    <div class="input-group">
        <input type="text" id="userInput" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n...">
        <button id="sendBtn" class="send-btn">GÃ¶nder</button>
    </div>

    <div id="aiResponse">Gemini'nin cevabÄ± burada gÃ¶rÃ¼necek...</div>
    <div id="errorLog"></div>
</div>

<script>
    // DÄ°KKAT: API AnahtarÄ±nÄ± aÅŸaÄŸÄ±daki tÄ±rnaklarÄ±n (" ") arasÄ±na yapÄ±ÅŸtÄ±r!
    var API_KEY = "AIzaSyAxmSqsLPuVSJx6bO5_zqTgHKg-lREllY4"; 

    var startBtn = document.getElementById('startBtn');
    var sendBtn = document.getElementById('sendBtn');
    var userInput = document.getElementById('userInput');
    var statusText = document.getElementById('status');
    var aiResponse = document.getElementById('aiResponse');
    var errorLog = document.getElementById('errorLog');

    function showLog(msg) {
        errorLog.style.display = "block";
        errorLog.innerText = "Sistem Notu: " + msg;
    }

    // 1. SES TANIMA KONTROLÃœ
    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        var recognition = new SpeechRecognition();
        recognition.lang = 'tr-TR';

        startBtn.onclick = function() {
            errorLog.style.display = "none";
            try {
                recognition.start();
                statusText.innerText = "Seni dinliyorum... KonuÅŸabilirsin.";
            } catch(e) { 
                showLog("Mikrofon hatasÄ±: " + e.message); 
            }
        };

        recognition.onresult = function(event) {
            var text = event.results[0][0].transcript;
            userInput.value = text;
            askGemini(text);
        };

        recognition.onerror = function(event) { 
            statusText.innerText = "Mikrofon kapandÄ±."; 
            showLog("Mikrofon HatasÄ±: " + event.error);
        };
    } else {
        startBtn.style.display = "none";
        statusText.innerText = "TarayÄ±cÄ± mikrofonu desteklemiyor.";
    }

    // 2. GÃ–NDERME Ä°ÅLEMLERÄ°
    sendBtn.onclick = function() { 
        var val = userInput.value.trim();
        if (val !== "") { askGemini(val); } 
    };

    userInput.onkeypress = function(e) { 
        if (e.key === "Enter") {
            var val = userInput.value.trim();
            if (val !== "") { askGemini(val); }
        }
    };

    // 3. GEMINI API Ã‡AÄRISI (EN GÃœVENLÄ° YAZIM ÅEKLÄ°)
    async function askGemini(soru) {
        statusText.innerText = "Gemini yanÄ±t hazÄ±rlÄ±yor...";
        aiResponse.innerText = "DÃ¼ÅŸÃ¼nÃ¼yor...";
        errorLog.style.display = "none";

        var apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEY;
        
        var requestBody = {
            contents: [{
                parts: [{ text: soru }]
            }]
        };

        try {
            var response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            var data = await response.json();

            if (data.error) {
                showLog("API HatasÄ±: " + data.error.message);
                aiResponse.innerText = "Hata oluÅŸtu, sistem notuna bak.";
                return;
            }

            if (data.candidates && data.candidates[0]) {
                var reply = data.candidates[0].content.parts[0].text;
                aiResponse.innerText = reply;
                statusText.innerText = "YanÄ±t geldi.";

                // Sesli Okuma
                var utter = new SpeechSynthesisUtterance(reply);
                utter.lang = 'tr-TR';
                window.speechSynthesis.speak(utter);
            } else {
                showLog("API boÅŸ yanÄ±t dÃ¶ndÃ¼.");
            }
        } catch (err) {
            showLog("BaÄŸlantÄ± HatasÄ±: " + err.message);
            aiResponse.innerText = "BaÄŸlantÄ± kurulamadÄ±.";
        }
    }
</script>

</body>
</html>
