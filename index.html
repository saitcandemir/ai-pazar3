<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saha ≈ûefi V19 - S√ºper Tolerans</title>
    <style>
        body { background: #0b0e14; color: #e6edf3; font-family: sans-serif; text-align: center; padding: 10px; margin: 0; }
        .wrapper { max-width: 600px; margin: 10px auto; background: #161b22; padding: 20px; border-radius: 25px; border: 2px solid #30363d; }
        #text-query { width: 90%; padding: 15px; border-radius: 12px; border: 2px solid #30363d; background: #0d1117; color: #58a6ff; font-size: 1.2rem; margin-bottom: 15px; outline: none; }
        #main-btn { width: 100%; padding: 45px 10px; font-size: 2.2rem; font-weight: 900; background: #238636; color: white; border: none; border-radius: 20px; cursor: pointer; }
        #main-btn.active { background: #da3633; box-shadow: 0 0 30px #da3633; }
        #status { margin: 10px 0; font-size: 1rem; color: #8b949e; }
        #live-text { background: #0d1117; padding: 15px; border-radius: 12px; border: 1px solid #30363d; min-height: 50px; color: #d1d5db; }
        #json-output { width: 100%; height: 100px; background: #000; color: #3fb950; font-family: monospace; font-size: 0.7rem; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2 style="color:#f0f6fc;">Saha ≈ûefi V19</h2>
    <input type="text" id="text-query" placeholder="Buraya yazabilirsin ≈üefim..." onkeypress="if(event.key==='Enter') searchEngine(this.value)">
    <button id="main-btn">üéôÔ∏è Sƒ∞STEMƒ∞ A√á</button>
    <div id="status">Veritabanƒ± kontrol ediliyor...</div>
    <div id="live-text">Komut bekliyorum.</div>
    <textarea id="json-output" readonly></textarea>
</div>

<script>
    const URL_M = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/main/muhabbet.js";
    const URL_I = "https://raw.githubusercontent.com/saitcandemir/ai-pazar3/refs/heads/main/is_emirleri.json";

    let database = [];
    let isListening = false;
    let learningMode = false;
    let lastQuery = "";

    async function setup() {
        try {
            // Dosyalarƒ± teker teker dene, biri bozuksa diƒüeri √ßalƒ±≈üsƒ±n
            const responses = await Promise.allSettled([
                fetch(URL_M + "?t=" + Date.now()).then(r => r.text()),
                fetch(URL_I + "?t=" + Date.now()).then(r => r.json())
            ]);

            database = [];

            // Muhabbet dosyasƒ±nƒ± i≈üle
            if (responses[0].status === "fulfilled") {
                try {
                    const cleanM = responses[0].value.match(/\[.*\]/s);
                    if (cleanM) database = [...database, ...JSON.parse(cleanM[0])];
                } catch(e) { console.log("Muhabbet dosyasƒ± bo≈ü veya hatalƒ±."); }
            }

            // ƒ∞≈ü emri dosyasƒ±nƒ± i≈üle
            if (responses[1].status === "fulfilled") {
                database = [...database, ...responses[1].value];
            }

            document.getElementById('status').innerText = "Sistem Hazƒ±r! (" + database.length + " kayƒ±t)";
        } catch (e) {
            document.getElementById('status').innerText = "Baƒülantƒ± saƒülandƒ±, veri bekleniyor.";
        }
    }

    function searchEngine(input) {
        const query = input.toLowerCase().trim();
        if (!query) return;

        if (learningMode) {
            database.unshift({"soru": lastQuery, "cevap": input});
            learningMode = false;
            document.getElementById('json-output').style.display = "block";
            document.getElementById('json-output').value = JSON.stringify(database.filter(x=>x.soru), null, 2);
            speak("√ñƒürendim ≈üefim!");
            return;
        }

        // AKILLI ARAMA: Her s√ºtuna bak
        const found = database.find(item => {
            return Object.values(item).some(v => v.toString().toLowerCase().includes(query));
        });

        if (found) {
            let res = found.cevap || `${found["ƒ∞≈ü ID"]} nolu i≈ü: ${found["ƒ∞≈ü A√ßƒ±klamasƒ±"]}. Kaynak: ${found["Kaynak√ßƒ± S√ºresi (Dakika)"]} dk.`;
            speak(res);
            document.getElementById('live-text').innerText = res;
        } else {
            learningMode = true;
            lastQuery = query;
            speak(query + " nedir? Cevabƒ± yaz ≈üefim.");
        }
    }

    // SES Sƒ∞STEMƒ∞
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new Speech();
    rec.lang = 'tr-TR';
    rec.continuous = true;

    function speak(t) {
        rec.stop();
        const s = new SpeechSynthesisUtterance(t);
        s.lang = 'tr-TR';
        s.onend = () => { if(isListening) rec.start(); };
        window.speechSynthesis.speak(s);
    }

    document.getElementById('main-btn').onclick = () => {
        if(!isListening) {
            rec.start(); isListening = true;
            document.getElementById('main-btn').innerText = "DURDUR";
            document.getElementById('main-btn').classList.add('active');
        } else {
            rec.stop(); isListening = false;
            document.getElementById('main-btn').innerText = "Sƒ∞STEMƒ∞ A√á";
            document.getElementById('main-btn').classList.remove('active');
        }
    };

    rec.onresult = (e) => searchEngine(e.results[e.results.length-1][0].transcript);
    window.onload = setup;
</script>
</body>
</html>
